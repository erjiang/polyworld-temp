
LIBRARIES="QtCore QtGui QtOpenGL"

if [ $CONFIGURATION == "Release" ] ; then
	if [ ! -e $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks ] ; then
		mkdir $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks
	fi
	for f in $LIBRARIES ; do
		if [ ! -e $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework ] ; then
			mkdir $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework
			mkdir $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/Versions
			cd $QtLib/$f.framework/Versions
			for v in `\ls -d [0-9]*` ; do
				mkdir $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/Versions/$v
				cp $QtLib/$f.framework/Versions/$v/$f* $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/Versions/$v/
				ln -sf $v/ $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/Versions/Current
				if [ "$f" == "QtCore" ] ; then
					mkdir $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/Versions/$v/Headers
					cp -R $QtLib/$f.framework/Versions/$v/Headers/arch $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/Versions/$v/Headers/
				fi
				install_name_tool -id @executable_path/../Frameworks/$f.framework/Versions/$v/$f $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/Versions/$v/$f
				install_name_tool -change /usr/local/Trolltech/Qt-4.1.0/lib/$f.framework/Versions/$v/$f @executable_path/../Frameworks/$f.framework/Versions/$v/$f $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/MacOS/$TARGET_NAME
			done
			cp -R $QtLib/$f.framework/$f* $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/
			cp -R $QtLib/$f.framework/Contents $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/
			cd $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/
			if [ "$f" == "QtCore" ] ; then
				ln -sf Versions/Current/Headers/ $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/Headers
				ln -sf Versions/Current/Headers/arch/ $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/arch
			else
				for g in $LIBRARIES ; do
					if [ "$g" != "$f" ] ; then
						cd $QtLib/$g.framework/Versions
						for v in `\ls -d [0-9]*` ; do
							install_name_tool -change /usr/local/Trolltech/Qt-4.1.0/lib/$g.framework/Versions/$v/$g @executable_path/../Frameworks/$g.framework/Versions/$v/$g $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/$f.framework/Versions/Current/$f
						done
					fi
				done
			fi
		fi
	done
	cp /usr/local/lib/libgsl.0.dylib $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/
	install_name_tool -id @executable_path/../Frameworks/libgsl.0.dylib $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/libgsl.0.dylib
	install_name_tool -change /usr/local/lib/libgsl.0.dylib @executable_path/../Frameworks/libgsl.0.dylib $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/MacOS/$TARGET_NAME
	cp /usr/local/lib/libgslcblas.0.dylib $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/
	install_name_tool -id @executable_path/../Frameworks/libgslcblas.0.dylib $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/Frameworks/libgslcblas.0.dylib
	install_name_tool -change /usr/local/lib/libgslcblas.0.dylib @executable_path/../Frameworks/libgslcblas.0.dylib $BUILT_PRODUCTS_DIR/$TARGET_NAME.app/Contents/MacOS/$TARGET_NAME
fi
